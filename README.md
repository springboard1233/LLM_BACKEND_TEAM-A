```markdown
# üí∏ Real-Time Fraud Detection API with LLM Explanations

This project deploys a robust machine learning model to detect transaction fraud in real-time, using a **FastAPI** service. A unique feature of this API is its integration with the **Google Gemini API** to generate plain-language explanations for why a specific transaction was flagged as high-risk.

## üöÄ Key Features

* **Real-Time Prediction:** Serves a pre-trained **Random Forest Classifier** (`fraud_model_rf1.pkl`).
* **LLM Integration:** Uses the **Gemini API** to provide human-readable, data-driven explanations for fraud alerts.
* **Data Persistence:** Stores transactions and fraud alerts in a **MySQL** database.
* **Analytics Endpoints:** Provides aggregated data endpoints for monitoring fraud trends.
* **Scalable Framework:** Built on **FastAPI** for high performance and easy scaling.

## üìÅ Project Structure

```

.
‚îú‚îÄ‚îÄ app.py                      \# FastAPI application: endpoints, ML model loading, database logic, and LLM explanation generation.
‚îú‚îÄ‚îÄ train\_model.py              \# Script for data analysis, preprocessing, SMOTE oversampling, training the Random Forest, and saving metrics/model.
‚îú‚îÄ‚îÄ fraud\_model\_rf1.pkl         \# Trained Scikit-learn Random Forest model.
‚îú‚îÄ‚îÄ LLM New.ipynb               \# Jupyter Notebook for initial LLM and database testing/exploration.
‚îú‚îÄ‚îÄ requirements.txt            \# (Missing, but assumed) Python dependencies list.
‚îú‚îÄ‚îÄ .env.example                \# Example environment file for configuration.
‚îî‚îÄ‚îÄ ... (data files like train.csv)

````

## ‚öôÔ∏è Setup and Installation

### Prerequisites

* Python 3.8+
* **MySQL** Database instance running locally or remotely.
* **Google Gemini API Key** (e.g., set as an environment variable).

### 1. Clone the repository

```bash
git clone <your-repo-url>
cd <repository-name>
````

### 2\. Install Dependencies

Since a `requirements.txt` file was not explicitly provided in this step, you will need to install the dependencies inferred from your code:

```bash
pip install fastapi uvicorn pandas numpy scikit-learn joblib pymysql sqlalchemy passlib python-dotenv google-genai
# If using SMOTE in train_model.py
pip install imblearn
```

### 3\. Environment Configuration

Create a file named **`.env`** in the root directory to manage your secrets and configuration (as used by `app.py`).

**.env** example:

```
# --- Database Configuration (MySQL) ---
DB_USER=root
DB_PASS=Varun23141  # IMPORTANT: Change this password
DB_HOST=127.0.0.1
DB_PORT=3306
DB_NAME=fraud_detection

# --- LLM Configuration ---
GEMINI_API_KEY=YOUR_GOOGLE_GEMINI_API_KEY_HERE
```

### 4\. Database Setup

Ensure your **MySQL** database is running and create the database named `fraud_detection`. The application logic relies on specific table schemas (`transactions`, `fraud_alerts`).

**Inferred MySQL Schema (simplified):**

```sql
-- Transactions Table
CREATE TABLE transactions (
    id INT AUTO_INCREMENT PRIMARY KEY,
    transaction_id VARCHAR(255) UNIQUE NOT NULL,
    customer_id VARCHAR(255),
    transaction_amount DECIMAL(10, 2) NOT NULL,
    channel VARCHAR(50),
    transaction_date DATETIME DEFAULT CURRENT_TIMESTAMP,
    is_fraud INT NOT NULL -- 0 for legitimate, 1 for fraudulent
);

-- Fraud Alerts Table
CREATE TABLE fraud_alerts (
    id INT AUTO_INCREMENT PRIMARY KEY,
    transaction_id VARCHAR(255) REFERENCES transactions(transaction_id),
    prediction_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    is_fraud_predicted INT NOT NULL,
    confidence_score FLOAT,
    llm_explanation TEXT
);
```

## üß† Training and Model Persistence

The `train_model.py` script is used to prepare your data and train the model.

1.  Place your training dataset (e.g., `train.csv`) according to the path specified in `train_model.py`.

2.  Execute the training script:

    ```bash
    python train_model.py
    ```

    This script will save the trained model as **`fraud_model_rf1.pkl`** and print the evaluation metrics to the console.

## ‚ñ∂Ô∏è Running the API

### Local Development (Uvicorn)

Use `uvicorn` to start the API for local testing with hot-reloading:

```bash
uvicorn app:app --reload --host 0.0.0.0 --port 8000
```

The API will be accessible at `http://0.0.0.0:8000`.

### Production Deployment (Gunicorn)

For production, you can use `gunicorn` with Uvicorn workers:

```bash
gunicorn -w 4 -k uvicorn.workers.UvicornWorker app:app
```

## üó∫Ô∏è API Endpoints

The interactive **Swagger UI** documentation is automatically generated by FastAPI and is available at:

`http://<host>:<port>/docs`

| HTTP Method | Endpoint | Description |
| :--- | :--- | :--- |
| **POST** | `/api/predict` | **Real-Time Check.** Submits a transaction, returns the ML prediction, logs the transaction, and fetches an LLM explanation if fraud is detected. |
| **GET** | `/api/transactions` | Retrieves transaction history from the database. |
| **GET** | `/api/analytics/fraud_over_time` | Returns time-series data for charting fraud rates. |
| **GET** | `/api/analytics/amount_vs_fraud` | Returns data for comparing transaction amounts between fraudulent and legitimate groups. |
| **GET** | `/api/model-info` | Returns the evaluation metrics (Accuracy, ROC AUC, etc.) of the loaded machine learning model. |

```
```